{% extends 'base.html' %} {% block style %}
<style>
    table,
    th,
    td {
        border: 1px solid black;
        border-collapse: collapse;
    }
    
    #btn {
        display: flex;
        align-items: center;
    }
</style>


{% endblock %} {% block body %}


<div style="height: 50px;">
    <div id="id"></div>
    <div id="id2"></div>
</div>
<div>
    <button class="btn btn-primary">Add Drop Student</button>

    <h3 class="text-center">Course Relust Details</h3>
    <table>
        <thead>
            <th>Registration No</th>
            <th>Name</th>
            <th>Term test</th>
            <th>Attendence</th>
            <th>Part A</th>
            <th>Part B</th>
            <th>Total Mark</th>
            <th>Grade Point</th>
            <th>Letter Grade</th>
        </thead>
        {% for i in context.course_result_set.all|dictsort:"Reg_No" %}
        <tr>
            <td>{{i.Reg_No}} </td>
            <td>{{i.Name}} </td>
            <td class="editable" data-id="{{i.id}}" data-type="Term_test">{{i.Term_test}} </td>
            <td class="editable" data-id="{{i.id}}" data-type="Attendence">{{i.Attendence}}</td>
            <td class="editable" data-id="{{i.id}}" data-type="Exam_Part_A">{{i.Exam_Part_A}}</td>
            <td class="editable" data-id="{{i.id}}" data-type="Exam_Part_B">{{i.Exam_Part_B}}</td>
            <td>{{i.Total_mark}} </td>
            <td>{{i.Grade_point}} </td>
            <td>{{i.Letter_grade}} </td>
        </tr>
        {% endfor %}
    </table>
</div>
<br>
<div class="row">
    <div class="col"></div>
    <div class="col-mid-auto">
        <div id="btn">
            <form action="" method="POST">
                {% csrf_token %}
                <div class="container">
                    <button class="btn btn-success" type="submit" name="Calculate">Calculate GPA</button>
                </div>
            </form>
            <form action="" method="POST">
                {% csrf_token %}
                <div class="container">
                    <button class="btn btn-success" type="submit" name="Submit">Submit</button>
                </div>
            </form>
        </div>
    </div>
    <div class="col"></div>
</div>


{% endblock %} {% block js_script %}
<script>
    $(document).ready(function() {
        $(document).on("dblclick", ".editable", function() {
            var value = $(this).text();
            var data_type = $(this).data("type");
            var input_type = "text";
            if (data_type == "created_at") {
                input_type = "datetime-local";
            }
            var input = "<input type='" + input_type + "' class='input-data' value='" + value + "' class='form-control'>";
            $(this).html(input);
            $(this).removeClass("editable");
        });
        $(document).on("blur", ".input-data", function() {
            var value = $(this).val();
            var td = $(this).parent("td");
            $(this).remove();
            td.html(value);
            td.addClass("editable");
            var type = td.data("type");
            sendToServer(td.data("id"), value, type);
        });
        $(document).on("keypress", ".input-data", function(e) {
            var key = e.which;
            if (key == 13) {
                var value = $(this).val();
                var td = $(this).parent("td");
                $(this).remove();
                td.html(value);
                td.addClass("editable");
                var type = td.data("type");
                sendToServer(td.data("id"), value, type);
            }
        });

        function sendToServer(id, value, type) {
            console.log(id);
            console.log(value);
            console.log(type);
            $.ajax({
                    url: "http://127.0.0.1:8000/saveresult",
                    type: "POST",
                    data: {
                        id: id,
                        type: type,
                        value: value,
                    },
                    success: function() {
                        $("#id").show();
                        $("#id").addClass("alert alert-success").html("Updated successfully");
                        setTimeout(function() {
                            $("#id").fadeOut("slow", function() {
                                $("#id").hide();
                            });
                        }, 2000);
                    }
                })
                .fail(function() {
                    $("#id2").show();
                    $("#id2").addClass("alert alert-danger").html("Error!");
                    setTimeout(function() {
                        $("#id2").fadeOut("slow", function() {
                            $("#id2").hide();
                        });
                    }, 2000);
                });

        }

    });
</script>
{% endblock %}